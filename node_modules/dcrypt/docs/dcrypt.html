<!DOCTYPE html>  <html> <head>   <title>dcrypt.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               dcrypt.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_bindings = </span><span class="nx">require</span> <span class="s1">&#39;./build/default/dcrypt&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>OpenSSL bindings for Node.js. This module extends what is in node-crypto bringing much needed additional functionality.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Random = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Random</span>
<span class="nv">Hash = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Hash</span>
<span class="nv">Sign = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Sign</span>
<span class="nv">Verify = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Verify</span>
<span class="nv">KeyPair = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">KeyPair</span>
<span class="nv">Encode = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Encode</span>
<span class="nv">Cipher = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Cipher</span>
<span class="nv">Rsa = </span><span class="nx">_bindings</span><span class="p">.</span><span class="nx">Rsa</span>

<span class="nv">dcrypt = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>Random</h1>

<p>Given a length, randomBytes returns a buffer full of random data. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.random = </span><span class="p">{}</span>
<span class="nv">dcrypt.random.randomBytes = </span><span class="nf">(len) -&gt;</span>
  <span class="nv">len = </span><span class="nx">len</span> <span class="o">or</span> <span class="mi">16</span>
  <span class="nv">buff = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="nx">len</span>
  <span class="nv">rb = </span><span class="k">new</span> <span class="nx">Random</span><span class="p">()</span>
  <span class="nx">rb</span><span class="p">.</span><span class="nx">randomBytes</span> <span class="nx">buff</span>
  <span class="k">return</span> <span class="nx">buff</span>

<span class="nv">exports.random = </span><span class="nx">dcrypt</span><span class="p">.</span><span class="nx">random</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>Hash</h1>

<p>Create a hash object to digest some messages. Call hash.update(msg) to continually digest new data and hash.final(encoding_type) to receive the final digested message.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.hash = </span><span class="nx">Hash</span>
<span class="nv">exports.hash = </span><span class="p">{}</span>
<span class="nv">exports.hash.createHash = </span><span class="nf">(hash) -&gt;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Hash</span> <span class="nx">hash</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>Sign</h1>

<p>Sign a message with a private key. This message can then be verified as coming from that private key with a corresponding public key. This object can take and PKI algorithm type, such as ECDSA and RSA. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.sign = </span><span class="nx">Sign</span>
<span class="nv">exports.sign = </span><span class="p">{}</span>
<span class="nv">exports.sign.createSign = </span><span class="nf">(algo) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Sign</span><span class="p">).</span><span class="nx">init</span> <span class="nx">algo</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>Verify</h1>

<p>Use verify to verify a signed message came from the associated private key. Verify.final can take either a PEM encoded certificate or a PEM encoded public key. Result of Verify.final is a boolean as to whether it passed or not. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.verify = </span><span class="nx">Verify</span>
<span class="nv">exports.verify= </span><span class="p">{}</span>
<span class="nv">exports.verify.createVerify= </span><span class="nf">(algo) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Verify</span><span class="p">).</span><span class="nx">init</span> <span class="nx">algo</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h1>Key Pairs</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.keypair = </span><span class="nx">KeyPair</span>
<span class="nv">exports.keypair = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>newRSA takes a size in bytes of the key, as well as a exponent size. Both these arguments are optional and default to 1024 for key and 65537 for exponent by default</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.keypair.newRSA = </span><span class="nf">(size, exp) -&gt;</span>
  <span class="nv">size = </span><span class="nx">size</span> <span class="o">||</span> <span class="mi">1024</span>
  <span class="nv">exp = </span><span class="nx">exp</span> <span class="o">||</span> <span class="mi">65537</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">KeyPair</span><span class="p">).</span><span class="nx">newRSA</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="nx">exp</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>newECDSA creates a new ecdsa key pair, if no curve is supplied it uses "secp256k1" as default</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.keypair.newECDSA = </span><span class="nf">(curve) -&gt;</span>
  <span class="nv">curve = </span><span class="nx">curve</span> <span class="o">or</span> <span class="s2">&quot;secp256k1&quot;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">KeyPair</span><span class="p">).</span><span class="nx">newECDSA</span><span class="p">(</span><span class="nx">curve</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>parseECDSA parses the raw ECDSA parameters from a PEM file's contents</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.keypair.parseECDSA = </span><span class="nf">(filename, public) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">KeyPair</span><span class="p">).</span><span class="nx">parseECDSA</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">public</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>parseRSA parses the raw RSA parameters from a PEM file's contents</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.keypair.parseRSA = </span><span class="nf">(filename, public) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">KeyPair</span><span class="p">).</span><span class="nx">parseRSA</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">public</span><span class="p">)</span>

<span class="nv">dcrypt.encode = </span><span class="nx">Encode</span>
<span class="nv">exports.encode = </span><span class="p">{}</span>
<span class="nv">exports.encode.encodeBase58 = </span><span class="nf">(data) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Encode</span><span class="p">).</span><span class="nx">encodeBase58</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

<span class="nv">exports.encode.decodeBase58 = </span><span class="nf">(data) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Encode</span><span class="p">).</span><span class="nx">decodeBase58</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h1>Cipher</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.cipher = </span><span class="nx">Cipher</span>
<span class="nv">exports.cipher = </span><span class="p">{}</span>
<span class="nv">exports.cipher.createCipher = </span><span class="nf">(cipher, key) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Cipher</span><span class="p">).</span><span class="nx">init</span><span class="p">(</span><span class="nx">cipher</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>

<span class="nv">exports.cipher.createCipheriv = </span><span class="nf">(cipher, key, iv) -&gt;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Cipher</span><span class="p">).</span><span class="nx">initiv</span><span class="p">(</span><span class="nx">cipher</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h1>RSA</h1>

<p>Encrypt a message with a RSA public key and decrypt it with the associated private key. Public key can either be in PEM key format or a PEM certificate. If no padding is chosen PKCS1 padding will be used. If no output encoding is supplied, hex is used.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dcrypt.rsa = </span><span class="nx">Rsa</span> 
<span class="nv">exports.rsa = </span><span class="p">{}</span>
<span class="nv">exports.rsa.encrypt = </span><span class="nf">(pem_pub, msg, padding, out_encoding) -&gt;</span>
  <span class="nv">out_encoding = </span><span class="nx">out_encoding</span> <span class="o">or</span> <span class="s1">&#39;hex&#39;</span>
  <span class="nv">padding = </span><span class="nx">padding</span> <span class="o">or</span> <span class="s1">&#39;RSA_PKCS1_PADDING&#39;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Rsa</span><span class="p">).</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">pem_pub</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">padding</span><span class="p">,</span> <span class="nx">out_encoding</span><span class="p">)</span>

<span class="nv">exports.rsa.decrypt = </span><span class="nf">(pem_priv, enc_msg, padding, in_encoding) -&gt;</span>
  <span class="nv">out_encoding = </span><span class="nx">out_encoding</span> <span class="o">or</span> <span class="s1">&#39;hex&#39;</span>
  <span class="nv">padding = </span><span class="nx">padding</span> <span class="o">or</span> <span class="s1">&#39;RSA_PKCS1_PADDING&#39;</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Rsa</span><span class="p">).</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">pem_priv</span><span class="p">,</span> <span class="nx">enc_msg</span><span class="p">,</span> <span class="nx">padding</span><span class="p">,</span> <span class="nx">in_encoding</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 